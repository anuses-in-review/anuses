---
title: "Anuses"
author: "Elise Navidad"
date: "November 2017 - March 2024"
output: html_document
---

```{r Setup and Import, include = FALSE}
# install.packages("here", repos = "http://cran.us.r-project.org")
library(here)

here::i_am("./coding-files/Main_Code.Rmd")

# /Users/eliserodriguez/Desktop/Projects/anuses/coding-files/Main_Code.Rmd

setup <- here("coding-files", "main-code-chunks", "setup")
source(here(setup, "setup.R")) # Packages
source(here(setup, "functions.R")) # Functions

Datanuses <- here("coding-files", "Excel", "Datanuses.xlsx")
data_anuses <- read.xlsx(Datanuses, sheet = 1)
data_actv <- read.xlsx(Datanuses, sheet = 2)

# View(data_anuses)

# View(data_actv)

rm(Datanuses)
```

```{r actv, include = TRUE, echo = FALSE}
source(here("coding-files", "main-code-chunks", "actv", "actv.R"))
```

### Vocalists (`vocs`)

```{r vocs, include = TRUE, echo = FALSE}
vocs <- here("coding-files", "main-code-chunks", "vocs")

source(here(vocs, "vocs_quan.R")) # Vocalist Name and Appearances
print("vocs_quan: Name | Appearances | Skin1 | Skin2 | Skin3 | Skin4 | Skin5 | GendM | GendW | GendO")
source(here(vocs, "table_vocs.R")) # Tables
print("table_vocs_quan: Rank | Artist | Appearances (Top 10)")
```

### Artists (`arts`)

```{r arts, include = TRUE, echo = FALSE}
arts <- here("coding-files", "main-code-chunks", "arts")

source(here(arts, "arts_quan.R")) # Artist Name and Appearances
print("arts_quan: Name | Appearances")
source(here(arts, "table_arts.R")) # Tables
print("table_arts_quan: Rank | Artist | Appearances (Top 10)")
```

### Streaks (`strk`)

```{r strk, include = TRUE, echo = FALSE}
strk <- here("coding-files", "main-code-chunks", "arts")



```

### Languages (`lang`)

```{r lang, include = TRUE, echo = FALSE}
lang <- here("coding-files", "main-code-chunks", "lang")

source(here(lang, "lang_quan.R")) # Language and Appearances
print("lang_quan: Language | Appearances")
source(here(lang, "table_lang.R")) # Tables
print("table_lang_quan: Rank | Languages | Appearances")
```

### Genres (`genr`)

```{r genr, include = TRUE, echo = FALSE}
genr <- here("coding-files", "main-code-chunks", "genr")

source(here(genr, "genr_quan.R")) # Genre and Appearances
source(here(genr, "table_genr.R")) # Tables
```

### Albums (`albm`)

```{r albm, include = TRUE, echo = FALSE}
albm <- here("coding-files", "main-code-chunks", "albm")

source(here(albm, "albm_quan.R")) # Album Name and Appearances
print("albm_quan: Album | Artist | Appearances")
source(here(albm, "albm_quan_trks.R")) # Excel sheet with number of tracks on each album
print("albm_quan_trks: Album | Tracks") # Album is a matching variable
source(here(albm, "albm_quan_uniq.R"))
print("albm_quan_uniq: Album | Artist | Included")
source(here(albm, "table_albm.R")) # Tables
print("table_albm_quan: Rank | Album | Artist | Appearances (Top 10)")
print("table_album_quan_uniq: Rank | Album | Artist | Inclusion (Top 10)")

```

### Songs (`song`)

```{r song, include = TRUE, echo = FALSE}
song <- here("coding-files", "main-code-chunks", "song")

source(here(song, "song_quan.R")) # Song Name and Appearances
print("song_quan: Song | Artist | Appearances")
source(here(song, "table_song.R")) # Tables
print("table_song_quan: Rank | Song | Artist | Appearances (Top 5)")
```

### Gender (`gend`)

```{r gend, include = TRUE, echo = FALSE}
gend <- here("coding-files", "main-code-chunks", "gend")

source(here(gend, "gend_quan.R")) # Gend quanities for anus and year
print("gend_quan: Anus | Men | Women | Other")
print("gend_quan_year: Year | Men | Women | Other")
source(here(gend, "gend_perc.R")) # Gend percentages for anus and year
print("gend_perc: Anus | Men | Women | Other")
print("gend_perc_year: Year | Men | Women | Other")
source(here(gend, "table_gend.R")) # Tables
print("table_gend_quan_year: Year | Men | Women | Other")
print("table_gend_perc_year: Year | Men | Women | Other")
source(here(gend, "plot_gend.R")) # Plots
```

### Skin (`skin`)

<span style="color: #d30000; font-size: 30px">haven't looked yet</span>

```{r skin, include = TRUE, echo = FALSE}
skin <- here("coding-files", "main-code-chunks", "skin")

source(here(skin, "skin_quan.R")) # Skin quanities for anus and year
print("skin_quan: Anus | Skin1 | Skin2 | Skin3 | Skin4 | Skin5")
print("skin_quan_year: Year | Skin1 | Skin2 | Skin3 | Skin4 | Skin5")
source(here(skin, "skin_perc.R")) # Skin percentages for anus and year
source(here(skin, "table_skin.R")) # Tables
source(here(skin, "plot_skin.R")) # Plots
```

### Plays (`play`)

<span style="color: #d30000; font-size: 30px">haven't looked yet</span>

```{r play, include = TRUE, echo = FALSE}
play <- here("coding-files", "main-code-chunks", "play")

source(here(play, "data_play.R")) # Datanuses with PlaysN
source(here(play, "play_quan.R")) # Play quantities for song, anus, and year
source(here(play, "play_arts_quan.R")) # Play quantities for Artist
source(here(play, "table_play.R")) # Tables
source(here(play, "plot_play.R")) # Plots
```

### Anus-Level Tables (`anus`)

<span style="color: #d30000; font-size: 30px">haven't looked yet</span>

```{r anus, include = TRUE, echo = FALSE}
anus <- here("coding-files", "main-code-chunks", "anus")

source(here(anus, "anus_data.R")) # Generates each Anus as its own data.frame
source(here(anus, "table_anus.R")) # Tables
```

### View

#### Tables

```{r All table_ output, results = 'asis', echo = FALSE}
# Get the names of objects in the global environment
table_names <- ls()

# Filter the names to include only those starting with "table_"
table_names <- table_names[grepl("^table_", table_names)]

# Initialize an empty character vector to store the HTML strings
table_html <- character(length(table_names))

# Generate kable outputs for each object and store them as HTML strings
for (i in seq_along(table_names)) {
  name <- table_names[i]
  # Retrieve the object from the global environment
  obj <- get(name)
  
  # Check if the object is a data frame
  if (is.data.frame(obj)) {
    xlsx_file <- paste0(name, ".xlsx")
    table_route <- here("coding-files", "Tables", xlsx_file)
    write.xlsx(obj, table_route, sheetName = "Sheet 1", rowNames = FALSE) # Export

    # Convert the table to HTML using knitr::kable()
    html_table <- kableExtra::kable_styling(knitr::kable(obj, format = "html"), full_width = FALSE)

    # Store the HTML table in the vector
    if (nchar(html_table) > 0) {
      table_html[i] <- paste0("<p><center><b>", name, "</b></center></p>", '<div id="', name, '" class="kable-output">', html_table, '</div>\n') # Includes name and html_table output
    }
  }
}

cat(table_html, sep = '') # Prints table_html

rm(html_table)
rm(obj)
rm(i)
rm(name)
rm(table_html)
rm(table_names)
rm(table_route)

```

#### Plots

<center>

```{r All plot_ output, results = 'asis', echo = FALSE}
plot_names <- ls()
plot_names <- plot_names[grepl("^plot_", plot_names)]
plot_html <- character(length(plot_names))
plot_route <- here("coding-files", "Plots")

# Loop through each plot
for (i in seq_along(plot_names)) {
  name <- plot_names[i]
  obj <- get(name) # Get the object
  if ("gg" %in% class(obj)) { # Check if "gg" is one of the classes
    png_file <- file.path(plot_route, paste0(name, ".png"))
    ggsave(png_file, obj, width = 8, height = 6, dpi = 600) # Adjust width, height, and dpi as needed

    # Render the ggplot to HTML using ggplot2's built-in print method
    plot_html[i] <- paste0("<p><center><b>", name, "</b></center></p>", "<img src='", png_file, "'>")
  }
  else {
    # If it's not a ggplot object, indicate it in the HTML
    plot_html[i] <- paste0("<p>", name, " is not a ggplot object</p>")
  }
}

cat(plot_html, sep = '') # Prints table_html

rm(data)
rm(data_melt)
rm(colors)
rm(color1)
rm(color2)
rm(coeff_plot_play_quan)
rm(coeff_plot_play_quan_year)
rm(title)

```

</center>

# UPDATE TO ALLOW HISTOGRAMS AS WELL :)

Update Album:

```{r, include = TRUE, echo = FALSE}
for (i in nrow(albm_quan):1) {
  if (grepl("Single", albm_quan[i, 1])) {
    print(paste0(albm_quan[i, 1], " may be a single."))
  }
}
```
